# Multiple Secret Hensel Codes (MSH Code)
Ruby code for the **MSH Code library**, a lightweight, probabilistic, general purpose, fully homomorphic data encoding mechanism. By David W. H. A. da Silva.

## Requirements

This code requires Ruby installed on your system. There are [several options for downloading and installing Ruby](https://www.ruby-lang.org/en/downloads/ "Download Ruby").

This project uses only Ruby standard libraries, so once you have Ruby installed (version 2.6.3 and greater), you have everything required to run the code. We tested our implementation on Mac OSX version 10.13.6 with ruby 2.6.3p62 (2019-04-16 revision 67580) [x86_64-darwin17].

## Contact

If you have any questions, comments of suggestions, feel free to send an email to dhonorio@uccs.edu .

## Usage

### Running tests

Once Ruby is installed on your machine, from the command line and in the root directory of the project, run the tests to check the code with the following command:

`$ rake`

You should get a result similiar to the following:

```console
Run options: --seed 9109

# Running:

...........

Finished in 5.316182s, 2.0692 runs/s, 9.0290 assertions/s.

11 runs, 48 assertions, 0 failures, 0 errors, 0 skips
```

### Ruby Interactive Shell

You can also run code from the Ruby Interactive Shell (IRB). From the project's root directory, execute the following command on the terminal:

`$ irb`

You will see the IRB's prompt. Next, command snippets for specific cases that can be executed on IRB.

#### Key Generation

Require the file the will boot the entire project on IRB:

`> require './x'`

Create the 'x' object with the required secret and public variables by passing a configuration for depth (first argument) and security parameter (second argument):

`> code = X::MSHCode.new 1024`

which return something like

`=> #<X::MSHCode:0x00007f98c6869410 @lambda=1024, @p1=1418335..., @p2=1556630..., @g=2207823...>`

Encode the number 219:

`> beta1 = code.encode(219)`

which returns it encoded value

`=> 6799619...`

Encryt the number 173:

`> beta2 = code.decode(173)`

which return it encoded value

` => 7027868...`

Add beta1 e beta2:

`> beta1_add_beta2 = code.add(beta1,beta2)`

returning

`=> => 750240...`

Multiply beta1 e beta2:

`> beta1_mul_beta2 = code.mul(beta1,beta2)`

returning

`=> 1427542...`

Decode beta1_mul_beta2

`> code.decode(beta1_add_beta2)`

which returns

`=> 392`

and we see that the result equals to 219 + 173 = 392

Decode beta1_mul_beta2:

`> code.decode(beta1_mul_beta2)`

which returns

`=> 37887`

and we see that the result equals to 219 * 173 = 37887

## Experiments

You can write your own experiments under the directory `experiments`. We added on file in there to serve as an example.

Here is the code for the file `experiments/dot_product.rb`:

```ruby
require './x'

lambda = 1024
code = X::MSHCode.new lambda

a = Array.new(4){ X::Tools.random_number(8) }
b = Array.new(4){ X::Tools.random_number(8) }

a_dot_b = a[0]*b[0] + a[1]*b[1] + a[2]*b[2] + a[3]*b[3]

beta_a = a.map{|aa| code.encode(aa)}
beta_b = b.map{|bb| code.encode(bb)}

beta_a_dot_beta_b_1 = code.add(code.mul(beta_a[0],beta_b[0]),code.mul(beta_a[1],beta_b[1]))
beta_a_dot_beta_b_2 = code.add(code.mul(beta_a[2],beta_b[2]),code.mul(beta_a[3],beta_b[3]))
beta_a_dot_beta_b = code.add(beta_a_dot_beta_b_1,beta_a_dot_beta_b_2)

beta_a_dot_beta_b_d = code.decode(beta_a_dot_beta_b)

puts "\n\nMSH Code: Dot product example\n\n"

puts "Given the two vectors:\n\n"

puts "a = #{a}"
puts "b = #{b}\n\n"

puts "a_dot_b = #{a_dot_b}\n\n"

puts "Encoded vectors a and b:\n\n"

puts "beta_a = #{beta_a}\n\n"
puts "beta_b = #{beta_b}\n\n"

puts "Decoded vectors for a and b:\n\n"

puts "beta_a_dot_beta_b_d = #{beta_a_dot_beta_b_d}\n\n"

puts "And we check that a_dot_b = beta_a_dot_beta_b_d\n\n"

```

To run it from terminal, given that you are on the project's root directory, execute the following:

`$ ruby experiments/dot_product.rb`

which yields something like

```shell
MSH Code: Dot product example

Given the two vectors:

a = [178, 172, 142, 155]
b = [149, 251, 249, 143]

a_dot_b = 127217

Encoded vectors a and b:

beta_a = [6099999927064955491170419808460827446909056065409507095934421586571903024810443361347232288265119265933678319899994883015995662201563318228377259188766855810168630679806068348034926027398921598291407061363915934026235874833959045562404759336880673432193041992405382429624304066799588441145424086531511739893875029521373664021768924550784498665393527671219612906096625013364595550320311248546720945551890081337388870387119135302449668201943430104852190706744251491571775454345811114203617376418040844904781624304008685842513867027618555717224513848700380328504598830936104923691094312239050760025035824698686452254337, 18546921739098782868866312307126909371523138736278393819169990179607796713077284562449743863187852316979837020968199739834145958055642039977789924318753795375317554893314707883382277981672877835867779758256216089463481087829195528430424001670140824185558058970778350096843782721789611463892420561391553777526548445701056768853408121197036832482425961456311115326103504995633338369091474698771282744435605640110697924520864951458251917150749968798444044343845818236806235194262234678654983421473400581406490247311808744864970245177809199052149613078835999027819247484164533644651361333357960724715308413420430353937422, 12446921812033827377695892498666081924614082670868886723235568593035893688266841201102511574922733051046158701068204856818150295854078721749412665129986939565148924213508639535347351954273956237576372696892300155437245212995236482868019242333260150753365016978372967667219478654990023022746996474860042037632673416179683104831639196646252333817032433785091502420006879982268742818771163450224561798883715558773309054133745816155802248948806538693591853637101566745234459739916423564451366045055359736501708623007800059022456378150190643334925099230135618699314648653228428720960267021118909964690272588721743901683233, 8285773037933725853012944626585746562577687207939706784118093410235547801954824367592683938023948081774710265411239506772437093224012678818262375149563985908412126031071342584581139392931986753959655582470234895192646690605324197242373106197075196536863297511140363816538409275331421170121617073507702657383580794302785277274298670419785070296231466957546451231797232675658462312023573536861161741098061235661223708822402293525514308395696270463672133277470654070039482272231911995150966541859588103934663626056773623082770546209090471924170520408478567344687819776657391328013367080115746583796850449412731188269688]

beta_b = [24235385069657211034444977312680358433772243901604780029493202733026220340144470459783564487465480717615511905421169471539876667838951882718403605586765271277466747483293271499288037509944944365836589196012684877848427857117623921087479221574523491136119545973913394513183302586271123004277597478261367921012217879994204138228341466506682437004077191723110267219177413416432014389194217692099470510354270061283867939308804844175863397777827268096817114677901630124893162596566710232785048644192644681824362914282846285145103038713838534935247341039644949285814761329506940445712324984528997410340009339245165144233603, 12693843769937743773050945380410508955410053210918759254602294012927981326912795679510558573315227570224960762336419947604309267305030807042070811882440167509960587067405142374624851853750069278569931271056768442822018676322554874611228965992758954642343949971935170475190349176380869163203144776657060595477596773316618881619740544190935670303277812227743779027820509937808294536901704403355681706663650954871840367493253361706705161493726217177479325860714630507325368571141224900495497337274637783193853997407582746359885022245144175235401170762870476741620099644584647594538345417759718409330473528046114898858115, 12282307173431216447459190577503130570750102310835638368991084979774501929169538215497146909327736704926957326889394796294044314886777331554307233961684787601941148977577637642495685354623214210247333647449321297180729570777024221705879426560260948160712394982664832461905564974062792262442897606995362999069391178088392586972904964949796776159535514823323318014797793345242375006684136148137148527030425294707621511894074119121866973918860086371000205488026190903840520519099889340421945183575841038706945040074611600797503948753554955401274384874979046671111014658990949471908214756691704334930138629172163236900158, 8368080357235031318131295587167222239509677387956330961240335216866243681503475860395366270821446254834310952500644537034490083707663373915815090733715061890016013649036843531006972692757357767624175107191724324320904511714430327823443014083574797833189608508994431419195366115795036550273666507440042176665221913348430536203665786268012849124979926438430543434401775994171646218067087187904868377024706367694067479942238142042481945910669496624967957352008341990736451882640179107165676972599347452832045417523367852195246760907408315890995877586056853358789636773776130952539393212329349398676917429187521520661267]

Decoded vectors for a and b:

beta_a_dot_beta_b_d = 127217

And we check that a_dot_b = beta_a_dot_beta_b_d
```
